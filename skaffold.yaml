apiVersion: skaffold/v2beta27
kind: Config
metadata:
  name: k8s-microservice-demo
build:
  artifacts:
  - image: backend
    context: src/backend
    docker:
      dockerfile: Dockerfile
  - image: frontend
    context: src/frontend
    docker:
      dockerfile: Dockerfile
  - image: auth
    context: src/auth
    docker:
      dockerfile: Dockerfile
  - image: blog
    context: src/blog
    docker:
      dockerfile: Dockerfile
  - image: gateway
    context: src/gateway
    docker:
      dockerfile: Dockerfile
deploy:
  kustomize:
    paths:
      - kustomize/base

profiles:
  - name: staging
    build:
      artifacts:
      - image: backend
      - image: frontend
      - image: auth
      - image: blog
    deploy:
      kustomize:
        paths:
          - kustomize/staging
  - name: production
    build:
      artifacts:
      - image: backend
      - image: frontend
      - image: auth
      - image: blog
    deploy:
      kustomize:
        paths:
          - kustomize/production
